"use strict";(function(a,b){return b=Hammer,{page:function(b){return a.each(a("html").attr("class").split(/\s+/),function(a,c){b||(c=c.split("-"),"page"==c[0]&&c[1]&&(b=c[1]))}),b||"unknown"}(),state:"pushState"in history,which:0,$h:new b.Manager(document.body,{recognizers:[[b.Tap],[b.Swipe,{direction:b.DIRECTION_HORIZONTAL}]]}),_on:[],_invoke:function(b,c,d){switch(d=this,typeof b){case"function":c=b,b=!0;break;case"string":b="*"==b||b==d.page;break;case"object":b=-1!=a.inArray(d.page,b);break;default:b=!1}b&&c.call(d,a)},on:function(a,b,c){return c=this,c._on.push([a,b]),c._invoke(a,b),c},once:function(a,b){return this._invoke(a,b),this},refresh:function(b){b=this,a.each(b._on,function(a,c){b._invoke(c[0],c[1])})},update:function(b,c){a("h2").text()!=b.t&&(document.title=b.n+" "+b.t+" | CCNR v2",c="<h2>"+b.t+"</h2>"+a.map(b.p,function(a){return"<p>"+a+"</p>"}).join("")+'<footer><nav><ul><li><a href="'+b["-"]+'"',"#"!=b["-"]&&(c+=' title="前一章"'),c+='><span class="iconfont icon-prev"></span></a></li><li><a href="." title="《'+b.n+'》章节目录"><span class="iconfont icon-list"></span></a></li><li><a href="'+b["+"]+'"',"#"!=b["+"]&&(c+=' title="后一章"'),c+='><span class="iconfont icon-next"></span></a></li></ul></nav></footer>',a("article").html(c),this.which=0,this.refresh())}}})(jQuery).once("toc",function(a,b){b=a(document.body),a(window).scroll(function(){0<window.scrollY?b.addClass("scrolled"):b.removeClass("scrolled")})}).once("chapter",function(a,b){b=a("footer nav a:last"),!document.referrer&&b.attr("href")&&a.getJSON(location.href+"/cd",{},function(a){a.quantity&&b.children(".badge").text(a.quantity).removeClass("hidden")})}).once("chapter",function(a,b){b=this,a(document).keydown(function(c,d){d=a.inArray(c.which,[37,13,39]),-1!=d&&c.which!=b.which&&(b.which=c.which,a("footer nav a:eq("+d+")").click())})}).once("chapter",function(a){this.$h.on("swipeleft",function(){a("footer nav a:last").click()}).on("swiperight",function(){a("footer nav a:first").click()})}).once("chapter",function(a){a(window).scroll(function(b){b=window.scrollY,a("p").each(function(c,d,e,f,g){e=a(d),f=e.offset().top,f>b||"read"==e.attr("class")||(g=e.height(),f+g>b||e.attr("class","read"))})})}).once("chapter",function(a){this.$h.on("tap",function(b,c){c=Math.round(2*a(window).height()/3),a(b.target).closest("ul").length||a("html, body").animate({scrollTop:(2*b.center.y>c?"+":"-")+"="+c})})}).on("chapter",function(a){a('a[href="#"]').click(function(){return!1})}).once("chapter",function(a,b){b=this,b.state&&(a(window).on("popstate",function(a){history.state&&b.update(history.state)}),a(document).ready(function(b,c){b=location.href.replace(/^.*\//,""),c={t:a("h2").text(),p:[],"-":a("footer nav a:first").attr("href"),"+":a("footer nav a:last").attr("href")},c.n=document.title.split(c.t)[0].replace(/\s*$/,""),a("p").each(function(b,d){c.p.push(a(d).text())}),history.replaceState(c,"",b)}))}).on("chapter",function(a,b,c,d){b=a("footer nav a:last"),c=b.attr("href"),d=this,d.state&&"#"!=c&&a.getJSON(c+".json",{},function(a){b.attr("class","prefetched"),d.$state=a})}).on("chapter",function(a,b,c){b=a('footer nav a:last[href!="#"]'),c=this,c.state&&b.click(function(){return c.$state?(history.pushState(c.$state,"",b.attr("href")),window.scrollTo(0,0),c.update(c.$state),!1):void 0})});