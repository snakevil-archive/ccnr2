"use strict";(function(a){return{p:function(b){return a.each(a("html").attr("class").split(/\s+/),function(a,c){b||(c=c.split("-"),"page"==c[0]&&c[1]&&(b=c[1]))}),b||"unknown"}(),s:"pushState"in history,w:0,_o:[],_d:a.Deferred().resolve(),_t:0,_i:function(b,c,d,e){d=this,e=a.Deferred(),d._d.done(function(f){switch(f=new a.Deferred,f.done(function(){e.resolve()}),typeof b){case"function":c=b,b=!0;break;case"string":b="*"==b||b==d.p;break;case"object":b=-1!=a.inArray(d.p,b);break;default:b=!1}return b?void c.call(d,a,f.resolve):f.resolve()}),d._d=e},on:function(a,b,c){return c=this,c._o.push([a,b]),c._i(a,b),c},once:function(a,b,c){return c=this,c._i(a,b),c},o:function(){return!1},e:function(b,c,d,e,f,g){a("body").append('<div class="error"><div class="_"></div><dl><dt><span class="ico ico-sad"></span></dt><dd>'+b+'</dd><dd>请<a href="#" onclick="location.reload();return 0">刷新页面</a>以尝试解决这个问题。</dd></dl></div>'),c=a(".error"),d=c.children("dl"),e=40,f=c.width(),g=Math.min(480,f-e),d.css({width:g,left:Math.floor((f-g)/2)}),d.css("top",Math.floor((c.height()-d.height()-e)/2)),c.css({top:0,left:0})},_r:function(b){b=this,a.each(b._o,function(a,c){b._i(c[0],c[1])})},r:function(b,c,d,e,f,g){a("h2").text()!=b.t&&(document.title=b.n+" "+b.t+" | CCNR v2",c=this,d=c._t.find("Chapter"),e="<h2>"+b.t+"</h2>"+a.map(b.p,function(a){return"<p>"+a+"</p>"}).join(""),f=a("aside a:first"),g=b["-"],f.attr("href",g),"#"==g?f.removeAttr("title").click(c.o):f.attr("title","《"+a(d.get(g-1)).text()+"》").off("click",c.o),f=a("aside a:last"),g=b["+"],f.attr("href",g),"#"==g?f.removeAttr("title").click(c.o):f.attr("title","《"+a(d.get(g-1)).text()+"》").off("click",c.o),a("article").html(e),this.w=0,this._r())}}})(jQuery).once(function(a,b,c,d,e,f,g,h,i){c=a(document.body),d=a("aside a:first"),e="scrolled",f="disabled",g="span",h="ico-top",i="ico-notop",a(window).scroll(function(){0<window.scrollY?(c.addClass(e),d.removeClass(f).children(g).addClass(h).removeClass(i)):(c.removeClass(e),d.addClass(f).children(g).addClass(i).removeClass(h))}),b()}).once("chapter",function(a,b,c){c=this,a.get(a("article").data("toc")).done(function(d,e){c._t=e=a(d),document.title=e.find("Title").text()+" "+document.title,b()}).fail(function(){c.e("章节列表数据读取失败")})}).once("chapter",function(a,b,c,d,e,f,g){c=this,d=location.pathname.split("/").pop()-0,e=c._t.find("Chapter"),f=a("aside a:eq(1)"),d>1?f.attr("href",d-1).attr("title","《"+a(e.get(d-2)).text()+"》").removeClass("disabled"):f.addClass("disabled").click(c.o),f=a("aside a:last"),d<e.length?(f.attr("href",d+1).attr("title","《"+a(e.get(d)).text()+"》").removeClass("disabled"),g=f.children(".badge"),g.text(e.length-d),document.referrer||g.removeClass("hidden")):f.addClass("disabled").click(c.o),a("aside").removeClass("hidden"),b()}).once("chapter",function(a,b,c){c=this,a(document).keydown(function(b,d){d=a.inArray(b.which,[37,13,39]),-1!=d&&b.which!=c.w&&(c.w=b.which,a("aside a:eq("+(1+d)+")").click())}),b()}).once("chapter",function(a,b,c){return c=this,c.s?(a(window).on("popstate",function(a){history.state&&c.r(history.state)}),void a(document).ready(function(c){c={t:a("h2").text(),p:[],"-":a("aside a:eq(1)").attr("href"),"+":a("aside a:last").attr("href")},c.n=document.title.split(c.t)[0].replace(/\s*$/,""),a("p").each(function(b,d){c.p.push(a(d).text())}),history.replaceState(c,"",location.href.replace(/^.*\//,"")),b()})):b()}).on("chapter",function(a,b,c,d,e){return c=this,d=a("aside a:last"),e=d.attr("href"),c.s&&"#"!=e?(e-=0,a.get(e).done(function(b,f,g){f=a(b),g={n:history.state.n,t:f.find("Title").text(),p:[],"-":"#","+":"#"},f.find("Paragraph").each(function(b,c){g.p.push(a(c).text())}),e>1&&(g["-"]=e-1),e<c._t.find("Chapter").length&&(g["+"]=e+1),d.attr("class","prefetched"),c._f=g}),void b()):b()}).on("chapter",function(a,b,c,d){return c=a('aside a:last[href!="#"]'),d=this,d.s?(c.click(function(b){return(b=d._f)?(history.pushState(b,"",c.attr("href")),window.scrollTo(0,0),d.r(b),delete d._f,a(".badge").addClass("hidden"),!1):!0}),void b()):b()});